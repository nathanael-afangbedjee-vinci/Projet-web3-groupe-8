(()=>{var e={};e.id=877,e.ids=[877],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},1282:e=>{"use strict";e.exports=require("child_process")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},1764:e=>{"use strict";e.exports=require("util")},3811:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>y,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{POST:()=>l});var o=r(2412),n=r(4293),a=r(4147);r(9025);var i=r(2265);r(1678);var c=r(4096),u=r(7856);let d=process.env.STRIPE_WEBHOOK_SECRET,l=async e=>{let t,r,s;let o=await e.text(),n=(await (0,i.A)()).get("stripe-signature");try{r=c.A.webhooks.constructEvent(o,n,d)}catch(e){return console.log(e),u.NextResponse.json({error:e.message},{status:500})}t=r.data,s=r.type;try{switch(s){case"checkout.session.completed":console.log("Traitement de checkout.session.completed");let e=await c.A.checkout.sessions.retrieve(t.object.id,{expand:["line_items"]});console.log("Session r\xe9cup\xe9r\xe9e :",e);let r=e?.customer_details?.email,o=e?.customer;if(!r)throw Error("no email passed during checkout");if(!o){console.log("---->GUEST USER"),console.log("-------> customer Email details :",r);let e=await c.A.customers.search({query:`email:"${r}"`});if(console.log("--------> Log de customers : ",e),e.data.length>0)o=e.data[0].id,console.log("----------> Client guest trouv\xe9 dans stripe.  CustomerID : ",o);else{let e=await c.A.customers.create({email:r});o=e.id,console.log("--------> NEW Customer Created : ",e)}console.log("----> FIN DE GUEST USER")}console.log("-----------> fin des check r\xe9cup\xe9 customerId : ",o);break;case"customer.subscription.deleted":case"checkout.session.expired":case"customer.subscription.created":break;default:console.log("\xc9v\xe9nement non g\xe9r\xe9 :",s)}return u.NextResponse.json({received:!0})}catch(e){return console.log(e),u.NextResponse.json({error:e.message},{status:500})}},p=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/webhooks/route",pathname:"/api/webhooks",filename:"route",bundlePath:"app/api/webhooks/route"},resolvedPagePath:"C:\\Users\\LXFZe\\Desktop\\stripe 2\\app\\api\\webhooks\\route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:f,serverHooks:y}=p;function g(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:f})}},5303:()=>{},4096:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(5435);if(!process.env.STRIPE_SECRET_KEY)throw Error("La cl\xe9 secr\xe8te Stripe (STRIPE_SECRET_KEY) est manquante dans le fichier .env");let o=new s.Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16",typescript:!1})},5730:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return a}});let s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(void 0);if(r&&r.has(e))return r.get(e);var s={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=n?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(s,a,i):s[a]=e[a]}return s.default=e,r&&r.set(e,s),s}(r(2052));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}let n={current:null};function a(e){return function(...t){console.error(e(...t))}}("function"==typeof s.cache?s.cache:e=>e)(e=>{try{console.error(n.current)}finally{n.current=null}})},9025:(e,t,r)=>{"use strict";r(3930),r(7722),r(9348),r(412),r(3887),r(8749),r(6524);let s=r(5730);r(7063);let o=new WeakMap;(0,s.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Error(`${r}used ${t}. \`cookies()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`)});function n(){return this.getAll().map(e=>[e.name,e]).values()}function a(e){for(let e of this.getAll())this.delete(e.name);return e}},1678:(e,t,r)=>{"use strict";let s=r(412),o=r(9348),n=r(3887),a=r(5730),i=r(8749),c=r(1513);new WeakMap;class u{constructor(e){this._provider=e}get isEnabled(){return null!==this._provider&&this._provider.isEnabled}enable(){d("draftMode().enable()"),null!==this._provider&&this._provider.enable()}disable(){d("draftMode().disable()"),null!==this._provider&&this._provider.disable()}}function d(e){let t=o.workAsyncStorage.getStore(),r=s.workUnitAsyncStorage.getStore();if(t){if(r){if("cache"===r.type)throw Error(`Route ${t.route} used "${e}" inside "use cache". The enabled status of draftMode can be read in caches but you must not enable or disable draftMode inside a cache. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`);if("unstable-cache"===r.type)throw Error(`Route ${t.route} used "${e}" inside a function cached with "unstable_cache(...)". The enabled status of draftMode can be read in caches but you must not enable or disable draftMode inside a cache. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`)}if(t.dynamicShouldError)throw new i.StaticGenBailoutError(`Route ${t.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`${e}\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`);if(r){if("prerender"===r.type){let s=Error(`Route ${t.route} used ${e} without first calling \`await connection()\`. See more info here: https://nextjs.org/docs/messages/next-prerender-sync-headers`);(0,n.abortAndThrowOnSynchronousRequestDataAccess)(t.route,e,s,r)}else if("prerender-ppr"===r.type)(0,n.postponeWithTracking)(t.route,e,r.dynamicTracking);else if("prerender-legacy"===r.type){r.revalidate=0;let s=new c.DynamicServerError(`Route ${t.route} couldn't be rendered statically because it used \`${e}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`);throw t.dynamicUsageDescription=e,t.dynamicUsageStack=s.stack,s}}}}(0,a.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Error(`${r}used ${t}. \`draftMode()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`)})},2265:(e,t,r)=>{"use strict";Object.defineProperty(t,"A",{enumerable:!0,get:function(){return d}});let s=r(8574),o=r(9348),n=r(412),a=r(3887),i=r(8749),c=r(6524),u=r(5730);function d(){let e=o.workAsyncStorage.getStore(),t=n.workUnitAsyncStorage.getStore();if(e){if(e.forceStatic)return p(s.HeadersAdapter.seal(new Headers({})));if(t){if("cache"===t.type)throw Error(`Route ${e.route} used "headers" inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "headers" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`);if("unstable-cache"===t.type)throw Error(`Route ${e.route} used "headers" inside a function cached with "unstable_cache(...)". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "headers" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`);if("after"===t.phase)throw Error(`Route ${e.route} used "headers" inside "unstable_after(...)". This is not supported. If you need this data inside an "unstable_after" callback, use "headers" outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/unstable_after`)}if(e.dynamicShouldError)throw new i.StaticGenBailoutError(`Route ${e.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`headers\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`);if(t){if("prerender"===t.type)return function(e,t){let r=l.get(t);if(r)return r;let s=(0,c.makeHangingPromise)(t.renderSignal,"`headers()`");return l.set(t,s),Object.defineProperties(s,{append:{value:function(){let r=`\`headers().append(${h(arguments[0])}, ...)\``,s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}},delete:{value:function(){let r=`\`headers().delete(${h(arguments[0])})\``,s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}},get:{value:function(){let r=`\`headers().get(${h(arguments[0])})\``,s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}},has:{value:function(){let r=`\`headers().has(${h(arguments[0])})\``,s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}},set:{value:function(){let r=`\`headers().set(${h(arguments[0])}, ...)\``,s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}},getSetCookie:{value:function(){let r="`headers().getSetCookie()`",s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}},forEach:{value:function(){let r="`headers().forEach(...)`",s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}},keys:{value:function(){let r="`headers().keys()`",s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}},values:{value:function(){let r="`headers().values()`",s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}},entries:{value:function(){let r="`headers().entries()`",s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}},[Symbol.iterator]:{value:function(){let r="`headers()[Symbol.iterator]()`",s=f(e,r);(0,a.abortAndThrowOnSynchronousRequestDataAccess)(e,r,s,t)}}}),s}(e.route,t);"prerender-ppr"===t.type?(0,a.postponeWithTracking)(e.route,"headers",t.dynamicTracking):"prerender-legacy"===t.type&&(0,a.throwToInterruptStaticGeneration)("headers",e,t)}(0,a.trackDynamicDataInDynamicRender)(e,t)}return p((0,n.getExpectedRequestStore)("headers").headers)}r(7063);let l=new WeakMap;function p(e){let t=l.get(e);if(t)return t;let r=Promise.resolve(e);return l.set(e,r),Object.defineProperties(r,{append:{value:e.append.bind(e)},delete:{value:e.delete.bind(e)},get:{value:e.get.bind(e)},has:{value:e.has.bind(e)},set:{value:e.set.bind(e)},getSetCookie:{value:e.getSetCookie.bind(e)},forEach:{value:e.forEach.bind(e)},keys:{value:e.keys.bind(e)},values:{value:e.values.bind(e)},entries:{value:e.entries.bind(e)},[Symbol.iterator]:{value:e[Symbol.iterator].bind(e)}}),r}function h(e){return"string"==typeof e?`'${e}'`:"..."}function f(e,t){let r=e?`Route "${e}" `:"This route ";return Error(`${r}used ${t}. \`headers()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`)}(0,u.createDedupedByCallsiteServerErrorLoggerDev)(f)},8574:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{HeadersAdapter:function(){return n},ReadonlyHeadersError:function(){return o}});let s=r(1152);class o extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new o}}class n extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,o){if("symbol"==typeof r)return s.ReflectAdapter.get(t,r,o);let n=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===n);if(void 0!==a)return s.ReflectAdapter.get(t,a,o)},set(t,r,o,n){if("symbol"==typeof r)return s.ReflectAdapter.set(t,r,o,n);let a=r.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===a);return s.ReflectAdapter.set(t,i??r,o,n)},has(t,r){if("symbol"==typeof r)return s.ReflectAdapter.has(t,r);let o=r.toLowerCase(),n=Object.keys(e).find(e=>e.toLowerCase()===o);return void 0!==n&&s.ReflectAdapter.has(t,n)},deleteProperty(t,r){if("symbol"==typeof r)return s.ReflectAdapter.deleteProperty(t,r);let o=r.toLowerCase(),n=Object.keys(e).find(e=>e.toLowerCase()===o);return void 0===n||s.ReflectAdapter.deleteProperty(t,n)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return o.callable;default:return s.ReflectAdapter.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new n(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,s]of this.entries())e.call(t,s,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},3930:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{MutableRequestCookiesAdapter:function(){return p},ReadonlyRequestCookiesError:function(){return i},RequestCookiesAdapter:function(){return c},appendMutableCookies:function(){return l},areCookiesMutableInCurrentPhase:function(){return f},getModifiedCookieValues:function(){return d},responseCookiesToRequestCookies:function(){return g},wrapWithMutableAccessCheck:function(){return h}});let s=r(7722),o=r(1152),n=r(9348),a=r(412);class i extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new i}}class c{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return i.callable;default:return o.ReflectAdapter.get(e,t,r)}}})}}let u=Symbol.for("next.mutated.cookies");function d(e){let t=e[u];return t&&Array.isArray(t)&&0!==t.length?t:[]}function l(e,t){let r=d(t);if(0===r.length)return!1;let o=new s.ResponseCookies(e),n=o.getAll();for(let e of r)o.set(e);for(let e of n)o.set(e);return!0}class p{static wrap(e,t){let r=new s.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let a=[],i=new Set,c=()=>{let e=n.workAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),a=r.getAll().filter(e=>i.has(e.name)),t){let e=[];for(let t of a){let r=new s.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}},d=new Proxy(r,{get(e,t,r){switch(t){case u:return a;case"delete":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.delete(...t),d}finally{c()}};case"set":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t),d}finally{c()}};default:return o.ReflectAdapter.get(e,t,r)}}});return d}}function h(e){let t=new Proxy(e,{get(e,r,s){switch(r){case"delete":return function(...r){return y("cookies().delete"),e.delete(...r),t};case"set":return function(...r){return y("cookies().set"),e.set(...r),t};default:return o.ReflectAdapter.get(e,r,s)}}});return t}function f(e){return"action"===e.phase}function y(e){if(!f((0,a.getExpectedRequestStore)(e)))throw new i}function g(e){let t=new s.RequestCookies(new Headers);for(let r of e.getAll())t.set(r);return t}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[267,793],()=>r(3811));module.exports=s})();